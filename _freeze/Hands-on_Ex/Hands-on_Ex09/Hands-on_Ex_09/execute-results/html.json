{
  "hash": "805243f203c88e457595c109559557e5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hands-on_Ex_09\"\nauthor: \"Cathy C.\"\ndate-modified: \"last-modified\" \nexecute:\n  echo: true \n  eval: true \n  warning: false \n  freeze: true  \n---\n\n\n\n# Modelling, Visualising and Analysing Network Data with R\n\n## 1 Overview\n\nLearning objectives include the following:\n\n-   create graph object data frames, manipulate them using appropriate functions of *dplyr, lubridate, and tidygraph.*\n\n-   build network graph visualisation using appropriate function of ***ggraph***\n\n-   compute network geometrics using ***tidygraph***\n\n-   build advanced gragh visualisation by incorporating the network ***geometrics***\n\n-   build interactive network visualisation using ***visNetwork*** package\n\n## 2 Getting started\n\nFour network data modeling and visualisation packages will be installed and launched. They are **igraph, tidygraph, ggraph** and **visNetwork.** In addition, **tidyverse** and **lubridate** (specially designed to handle and wrangling time data) will be installed and launched, too.\n\n## 3 The data\n\nThe data sets used in this hands-on exercise is from an oil exploration and extraction company. There are two data sets. One contains the nodes data and the other contains the edges (also know as link) data.\n\n### 3.1 The edges data\n\n*GAStech-email_edges.csv* which consists of two weeks of 9063 emails correspondances between 55 employees.\n\n### 3.2 The nodes data\n\n*GAStech_email_nodes.csv* which consist of the names, department and title of the 55 employees.\n\n### 3.3 Importing network data from files\n\nimport *GAStech_email_node.csv* and *GAStech_email_edges-v2.csv* into RStudio environment by using `read_csv()` of **readr** package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(readr, dplyr, lubridate)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_nodes <- read_csv(\"data/GAStech_email_node.csv\")\nGAStech_edges <- read_csv(\"data/GAStech_email_edge-v2.csv\")\n```\n:::\n\n\n\n### 3.4 Reviewing the imported data\n\nNext, we examine the structure of the data frame using *glimpse()* of **dplyr**.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(GAStech_edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 9,063\nColumns: 8\n$ source      <dbl> 43, 43, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 26, 26, 26…\n$ target      <dbl> 41, 40, 51, 52, 53, 45, 44, 46, 48, 49, 47, 54, 27, 28, 29…\n$ SentDate    <chr> \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\"…\n$ SentTime    <time> 08:39:00, 08:39:00, 08:58:00, 08:58:00, 08:58:00, 08:58:0…\n$ Subject     <chr> \"GT-SeismicProcessorPro Bug Report\", \"GT-SeismicProcessorP…\n$ MainSubject <chr> \"Work related\", \"Work related\", \"Work related\", \"Work rela…\n$ sourceLabel <chr> \"Sven.Flecha\", \"Sven.Flecha\", \"Kanon.Herrero\", \"Kanon.Herr…\n$ targetLabel <chr> \"Isak.Baza\", \"Lucas.Alcazar\", \"Felix.Resumir\", \"Hideki.Coc…\n```\n\n\n:::\n:::\n\n\n\n::::: goals\n::: goals-header\nNote\n:::\n\n::: goals-container\nThe output report of GAStech_edges above reveals that the *SentDate* is treated as “Character” data type instead of *date* data type. It is important to change the data type of *SentDate* field back to “Date”” data type.\n:::\n:::::\n\n### 3.5 Wrangling time\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_edges <- GAStech_edges %>%\n  mutate(SendDate = dmy(SentDate)) %>%\n  mutate(Weekday = wday(SentDate,\n                        label = TRUE,\n                        abbr = FALSE))\n```\n:::\n\n\n\n::::: goals\n::: goals-header\nLearn from the code\n:::\n\n::: goals-container\n-   both *dmy()* and *wday()* are functions of **lubridate** package. [lubridate](https://r4va.netlify.app/cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html) is an R package that makes it easier to work with dates and times.\n-   *dmy()* transforms the SentDate to Date data type.\n-   *wday()* returns the day of the week as a decimal number or an ordered factor if label is TRUE. The argument abbr is FALSE keep the daya spells in full, i.e. Monday. The function will create a new column in the data.frame i.e. Weekday and the output of *wday()* will save in this newly created field.\n-   the values in the *Weekday* field are in ordinal scale.\n\n:::\n:::::\n\n### 3.6 Reviewomg the revised date fields\nTable below shows the data structure of the reformatted GAStech_edges data frame.\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 9,063\nColumns: 10\n$ source      <dbl> 43, 43, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 26, 26, 26…\n$ target      <dbl> 41, 40, 51, 52, 53, 45, 44, 46, 48, 49, 47, 54, 27, 28, 29…\n$ SentDate    <chr> \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\"…\n$ SentTime    <time> 08:39:00, 08:39:00, 08:58:00, 08:58:00, 08:58:00, 08:58:0…\n$ Subject     <chr> \"GT-SeismicProcessorPro Bug Report\", \"GT-SeismicProcessorP…\n$ MainSubject <chr> \"Work related\", \"Work related\", \"Work related\", \"Work rela…\n$ sourceLabel <chr> \"Sven.Flecha\", \"Sven.Flecha\", \"Kanon.Herrero\", \"Kanon.Herr…\n$ targetLabel <chr> \"Isak.Baza\", \"Lucas.Alcazar\", \"Felix.Resumir\", \"Hideki.Coc…\n$ SendDate    <date> 2014-01-06, 2014-01-06, 2014-01-06, 2014-01-06, 2014-01-0…\n$ Weekday     <ord> Friday, Friday, Friday, Friday, Friday, Friday, Friday, Fr…\n```\n\n\n:::\n:::\n\n\n\n### 3.7 Wrangling attributes\n\n### 3.8 Reviewing the revised edges file\n\n### \n\n## 4 Creating network objects using **tidygraph**\n\n## 5 Plotting static network graphs with **ggraph** package\n\n## 6 Creating face graphs\n\n## 7 Network metrics analysis\n\n## 8 Building interactive network graph with visNetwork\n\n## 9 Reference\n\n# STUDY\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidygraph)\ncreate_ring(10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 10 nodes and 10 edges\n#\n# An undirected simple graph with 1 component\n#\n# Node Data: 10 × 0 (active)\n#\n# Edge Data: 10 × 2\n   from    to\n  <int> <int>\n1     1     2\n2     2     3\n3     3     4\n# ℹ 7 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\niris_clust <- hclust(dist(iris[1:4]))\niris_tree <- as_tbl_graph(iris_clust)\niris_tree\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 299 nodes and 298 edges\n#\n# A rooted tree\n#\n# Node Data: 299 × 4 (active)\n   height leaf  label members\n    <dbl> <lgl> <chr>   <int>\n 1  0     TRUE  \"108\"       1\n 2  0     TRUE  \"131\"       1\n 3  0.265 FALSE \"\"          2\n 4  0     TRUE  \"103\"       1\n 5  0     TRUE  \"126\"       1\n 6  0     TRUE  \"130\"       1\n 7  0.346 FALSE \"\"          2\n 8  0.520 FALSE \"\"          3\n 9  0.557 FALSE \"\"          5\n10  0     TRUE  \"119\"       1\n# ℹ 289 more rows\n#\n# Edge Data: 298 × 2\n   from    to\n  <int> <int>\n1     3     1\n2     3     2\n3     7     5\n# ℹ 295 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\niris_tree %>% activate(edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 299 nodes and 298 edges\n#\n# A rooted tree\n#\n# Edge Data: 298 × 2 (active)\n    from    to\n   <int> <int>\n 1     3     1\n 2     3     2\n 3     7     5\n 4     7     6\n 5     8     4\n 6     8     7\n 7     9     3\n 8     9     8\n 9    13    11\n10    13    12\n# ℹ 288 more rows\n#\n# Node Data: 299 × 4\n  height leaf  label members\n   <dbl> <lgl> <chr>   <int>\n1  0     TRUE  \"108\"       1\n2  0     TRUE  \"131\"       1\n3  0.265 FALSE \"\"          2\n# ℹ 296 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nas_tibble(iris_tree)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 299 × 4\n   height leaf  label members\n    <dbl> <lgl> <chr>   <int>\n 1  0     TRUE  \"108\"       1\n 2  0     TRUE  \"131\"       1\n 3  0.265 FALSE \"\"          2\n 4  0     TRUE  \"103\"       1\n 5  0     TRUE  \"126\"       1\n 6  0     TRUE  \"130\"       1\n 7  0.346 FALSE \"\"          2\n 8  0.520 FALSE \"\"          3\n 9  0.557 FALSE \"\"          5\n10  0     TRUE  \"119\"       1\n# ℹ 289 more rows\n```\n\n\n:::\n:::\n\n\n\n## The dplyr verbs\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\niris_tree <- iris_tree %>% \n    activate(nodes) %>% \n    mutate(Species = ifelse(leaf, as.character(iris$Species)[label], NA)) %>% \n    activate(edges) %>% \n    mutate(to_setose = .N()$Species[to] == 'setosa')\niris_tree\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 299 nodes and 298 edges\n#\n# A rooted tree\n#\n# Edge Data: 298 × 3 (active)\n    from    to to_setose\n   <int> <int> <lgl>    \n 1     3     1 NA       \n 2     3     2 NA       \n 3     7     5 NA       \n 4     7     6 NA       \n 5     8     4 NA       \n 6     8     7 NA       \n 7     9     3 NA       \n 8     9     8 NA       \n 9    13    11 NA       \n10    13    12 NA       \n# ℹ 288 more rows\n#\n# Node Data: 299 × 5\n  height leaf  label members Species\n   <dbl> <lgl> <chr>   <int> <chr>  \n1  0     TRUE  \"108\"       1 <NA>   \n2  0     TRUE  \"131\"       1 <NA>   \n3  0.265 FALSE \"\"          2 <NA>   \n# ℹ 296 more rows\n```\n\n\n:::\n:::\n\n\n\n`.N()` function is used to gain access to the node data while manipulating the edge data. Similarly `.E()` will give you the edge data and `.G()` will give you the `tbl_graph` object itself.\n\nWhile one might expect all of `dplyr`s verbs to be supported in that manner, there is a clear limitation in the relational data structure that requires rows to maintain their identity. Thus, `summarise()` and `do()` are not allowed as there is no clear interpretation of how alterations on the node and edge data with these verbs should be interpreted. If these operations are required I suggest applying them to a tibble representation and then joining the result back in.\n\nSpeaking of joining, all joins from `dplyr` are supported. Nodes and edges are added and removed as required by the join. New edge data to be joined in must have a `to` and `from` column referencing valid nodes in the existing graph.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\niris_sum <- iris %>% \n    group_by(Species) %>% \n    summarise_all(mean) %>% \n    ungroup()\niris_tree <- iris_tree %>% \n    activate(nodes) %>% \n    left_join(iris_sum)\niris_tree\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 299 nodes and 298 edges\n#\n# A rooted tree\n#\n# Node Data: 299 × 9 (active)\n   height leaf  label members Species Sepal.Length Sepal.Width Petal.Length\n    <dbl> <lgl> <chr>   <int> <chr>          <dbl>       <dbl>        <dbl>\n 1  0     TRUE  \"108\"       1 <NA>              NA          NA           NA\n 2  0     TRUE  \"131\"       1 <NA>              NA          NA           NA\n 3  0.265 FALSE \"\"          2 <NA>              NA          NA           NA\n 4  0     TRUE  \"103\"       1 <NA>              NA          NA           NA\n 5  0     TRUE  \"126\"       1 <NA>              NA          NA           NA\n 6  0     TRUE  \"130\"       1 <NA>              NA          NA           NA\n 7  0.346 FALSE \"\"          2 <NA>              NA          NA           NA\n 8  0.520 FALSE \"\"          3 <NA>              NA          NA           NA\n 9  0.557 FALSE \"\"          5 <NA>              NA          NA           NA\n10  0     TRUE  \"119\"       1 <NA>              NA          NA           NA\n# ℹ 289 more rows\n# ℹ 1 more variable: Petal.Width <dbl>\n#\n# Edge Data: 298 × 3\n   from    to to_setose\n  <int> <int> <lgl>    \n1     3     1 NA       \n2     3     2 NA       \n3     7     5 NA       \n# ℹ 295 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggraph)\ngr1 <- create_notable('bull') %>% \n    mutate(name = letters[1:5])\ngr2 <- create_ring(5) %>% \n    mutate(name = letters[4:8])\n\n# Plot\ngr1 %>% bind_graphs(gr2) %>% \n    ggraph(layout = 'kk') + \n    geom_edge_link() + \n    geom_node_point(size = 8, colour = 'steelblue') +\n    geom_node_text(aes(label = name), colour = 'white', vjust = 0.4) + \n    ggtitle('Binding graphs') + \n    theme_graph()\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_09_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngr1 %>% graph_join(gr2) %>% \n    ggraph(layout = 'kk') + \n    geom_edge_link() + \n    geom_node_point(size = 8, colour = 'steelblue') +\n    geom_node_text(aes(label = name), colour = 'white', vjust = 0.4) + \n    ggtitle('Joining graphs') + \n    theme_graph()\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_09_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Hands-on_Ex_09_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}