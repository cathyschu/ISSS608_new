{
  "hash": "74757c96e7f87a8824e1128849f4569e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hands-on_Ex_09\"\nauthor: \"Cathy C.\"\ndate-modified: \"last-modified\" \nexecute:\n  echo: true \n  eval: true \n  warning: false \n  freeze: true  \n---\n\n\n\n# Modelling, Visualising and Analysing Network Data with R\n\n## 1 Overview\n\nLearning objectives include the following:\n\n-   create graph object data frames, manipulate them using appropriate functions of *dplyr, lubridate, and tidygraph.*\n\n-   build network graph visualisation using appropriate function of ***ggraph***\n\n-   compute network geometrics using ***tidygraph***\n\n-   build advanced gragh visualisation by incorporating the network ***geometrics***\n\n-   build interactive network visualisation using ***visNetwork*** package\n\n## 2 Getting started\n\nFour network data modeling and visualisation packages will be installed and launched. They are **igraph, tidygraph, ggraph** and **visNetwork.** In addition, **tidyverse** and **lubridate** (specially designed to handle and wrangling time data) will be installed and launched, too.\n\n## 3 The data\n\nThe data sets used in this hands-on exercise is from an oil exploration and extraction company. There are two data sets. One contains the nodes data and the other contains the edges (also know as link) data.\n\n### 3.1 The edges data\n\n*GAStech-email_edges.csv* which consists of two weeks of 9063 emails correspondances between 55 employees.\n\n### 3.2 The nodes data\n\n*GAStech_email_nodes.csv* which consist of the names, department and title of the 55 employees.\n\n### 3.3 Importing network data from files\n\nimport *GAStech_email_node.csv* and *GAStech_email_edges-v2.csv* into RStudio environment by using `read_csv()` of **readr** package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(readr, dplyr, lubridate, tidygraph, ggraph)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_nodes <- read_csv(\"data/GAStech_email_node.csv\")\nGAStech_edges <- read_csv(\"data/GAStech_email_edge-v2.csv\")\n```\n:::\n\n\n\n### 3.4 Reviewing the imported data\n\nNext, we examine the structure of the data frame using *glimpse()* of **dplyr**.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(GAStech_edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 9,063\nColumns: 8\n$ source      <dbl> 43, 43, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 26, 26, 26‚Ä¶\n$ target      <dbl> 41, 40, 51, 52, 53, 45, 44, 46, 48, 49, 47, 54, 27, 28, 29‚Ä¶\n$ SentDate    <chr> \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\"‚Ä¶\n$ SentTime    <time> 08:39:00, 08:39:00, 08:58:00, 08:58:00, 08:58:00, 08:58:0‚Ä¶\n$ Subject     <chr> \"GT-SeismicProcessorPro Bug Report\", \"GT-SeismicProcessorP‚Ä¶\n$ MainSubject <chr> \"Work related\", \"Work related\", \"Work related\", \"Work rela‚Ä¶\n$ sourceLabel <chr> \"Sven.Flecha\", \"Sven.Flecha\", \"Kanon.Herrero\", \"Kanon.Herr‚Ä¶\n$ targetLabel <chr> \"Isak.Baza\", \"Lucas.Alcazar\", \"Felix.Resumir\", \"Hideki.Coc‚Ä¶\n```\n\n\n:::\n:::\n\n\n\n::::: goals\n::: goals-header\nNote\n:::\n\n::: goals-container\nThe output report of GAStech_edges above reveals that the *SentDate* is treated as ‚ÄúCharacter‚Äù data type instead of *date* data type. It is important to change the data type of *SentDate* field back to ‚ÄúDate‚Äù‚Äù data type.\n:::\n:::::\n\n### 3.5 Wrangling time\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_edges <- GAStech_edges %>%\n  mutate(SendDate = dmy(SentDate)) %>%\n  mutate(Weekday = wday(SentDate,\n                        label = TRUE,\n                        abbr = FALSE))\n```\n:::\n\n\n\n::::: goals\n::: goals-header\nLearn from the code\n:::\n\n::: goals-container\n-   both *dmy()* and *wday()* are functions of **lubridate** package. [lubridate](https://r4va.netlify.app/cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html) is an R package that makes it easier to work with dates and times.\n-   *dmy()* transforms the SentDate to Date data type.\n-   *wday()* returns the day of the week as a decimal number or an ordered factor if label is TRUE. The argument abbr is FALSE keep the daya spells in full, i.e.¬†Monday. The function will create a new column in the data.frame i.e.¬†Weekday and the output of *wday()* will save in this newly created field.\n-   the values in the *Weekday* field are in ordinal scale.\n:::\n:::::\n\n### 3.6 Reviewomg the revised date fields\n\nTable below shows the data structure of the reformatted GAStech_edges data frame.\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 9,063\nColumns: 10\n$ source      <dbl> 43, 43, 44, 44, 44, 44, 44, 44, 44, 44, 44, 44, 26, 26, 26‚Ä¶\n$ target      <dbl> 41, 40, 51, 52, 53, 45, 44, 46, 48, 49, 47, 54, 27, 28, 29‚Ä¶\n$ SentDate    <chr> \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\", \"6/1/2014\"‚Ä¶\n$ SentTime    <time> 08:39:00, 08:39:00, 08:58:00, 08:58:00, 08:58:00, 08:58:0‚Ä¶\n$ Subject     <chr> \"GT-SeismicProcessorPro Bug Report\", \"GT-SeismicProcessorP‚Ä¶\n$ MainSubject <chr> \"Work related\", \"Work related\", \"Work related\", \"Work rela‚Ä¶\n$ sourceLabel <chr> \"Sven.Flecha\", \"Sven.Flecha\", \"Kanon.Herrero\", \"Kanon.Herr‚Ä¶\n$ targetLabel <chr> \"Isak.Baza\", \"Lucas.Alcazar\", \"Felix.Resumir\", \"Hideki.Coc‚Ä¶\n$ SendDate    <date> 2014-01-06, 2014-01-06, 2014-01-06, 2014-01-06, 2014-01-0‚Ä¶\n$ Weekday     <ord> Friday, Friday, Friday, Friday, Friday, Friday, Friday, Fr‚Ä¶\n```\n\n\n:::\n:::\n\n\n\n### 3.7 Wrangling attributes\n\nA close examination of *GAStech_edges* data.frame reveals that it consists of individual e-mail flow records. This is not very useful for visualisation. We will aggregate the individual by date, senders, receivers, main subject and day of the week.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_edges_aggregated <- GAStech_edges %>%\n  filter(MainSubject == \"Work related\") %>%\n  group_by(source, target, Weekday) %>%\n    summarise(Weight = n()) %>%\n  filter(source!=target) %>%\n  filter(Weight > 1) %>%\n  ungroup()\n```\n:::\n\n\n\n::::: goals\n::: goals-header\nLearn from the code\n:::\n\n::: goals-container\n-   four functions from **dplyr** package are used. They are: *filter()*, *group()*, *summarise()*, and *ungroup()*.\n-   The output data.frame is called **GAStech_edges_aggregated**.\n-   A new field called *Weight* has been added in GAStech_edges_aggregated.\n:::\n:::::\n\n### 3.8 Reviewing the revised edges file\n\nTable below shows the data structure of the reformatted GAStech_edges data frame.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(GAStech_edges_aggregated)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,372\nColumns: 4\n$ source  <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,‚Ä¶\n$ target  <dbl> 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 6,‚Ä¶\n$ Weekday <ord> Sunday, Monday, Tuesday, Wednesday, Friday, Sunday, Monday, Tu‚Ä¶\n$ Weight  <int> 5, 2, 3, 4, 6, 5, 2, 3, 4, 6, 5, 2, 3, 4, 6, 5, 2, 3, 4, 6, 5,‚Ä¶\n```\n\n\n:::\n:::\n\n\n\n## 4 Creating network objects using **tidygraph**\n\nIn this section, we will learn how to create a graph data model by using tidygraph package. It provides a tidy API for graph/network manipulation. While network data itself is not tidy, it can be envisioned as two tidy tables, one for node data and one for edge data. **tidygraph** provides a way to switch between the two tables and provides dplyr verbs for manipulating them. Furthermore it provides access to a lot of graph algorithms with return values that facilitate their use in a tidy workflow.\n\n::::: goals\n::: goals-header\nRead\n:::\n\n::: goals-container\n-   [Introducing tidygraph](https://www.data-imaginist.com/2017/introducing-tidygraph/)\n\n-   [tidygraph 1.1 - A tidy hope](https://www.data-imaginist.com/2018/tidygraph-1-1-a-tidy-hope/)\n:::\n:::::\n\n### 4.1 **The tbl_graph object**\n\nTwo functions of **tidygraph** package can be used to create network objects, they are:\n\n-   [`tbl_graph()`](https://tidygraph.data-imaginist.com/reference/tbl_graph.html) creates a **tbl_graph** network object from nodes and edges data.\n\n-   [`as_tbl_graph()`](https://tidygraph.data-imaginist.com/reference/tbl_graph.html) converts network data and objects to a **tbl_graph** network. Below are network data and objects supported by `as_tbl_graph()`\n\n    -   a node data.frame and an edge data.frame,\n    -   data.frame, list, matrix from base,\n    -   igraph from igraph,\n    -   network from network,\n    -   dendrogram and hclust from stats,\n    -   Node from data.tree,\n    -   phylo and evonet from ape, and\n    -   graphNEL, graphAM, graphBAM from graph (in Bioconductor).\n\n### 4.2 **The dplyr verbs in tidygraph**\n\n-   *activate()* verb from **tidygraph** serves as a switch between tibbles for nodes and edges. All dplyr verbs applied to **tbl_graph** object are applied to the active tibble.\n\n![](images/image3.jpg){width=\"600\"}\n\n-   In the above the *.N()* function is used to gain access to the node data while manipulating the edge data. Similarly *.E()* will give you the edge data and *.G()* will give you the **tbl_graph** object itself.\n\n### 4.3 **Using `tbl_graph()` to build tidygraph data model.**\n\nIn this section, we will use `tbl_graph()` of **tinygraph** package to build an tidygraph‚Äôs network graph data.frame.\n\nüéØ **Reference guide: [`tbl_graph()`](https://tidygraph.data-imaginist.com/reference/tbl_graph.html)**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_graph <- tbl_graph(nodes = GAStech_nodes,\n                           edges = GAStech_edges_aggregated, \n                           directed = TRUE)\n```\n:::\n\n\n\n### 4.4 **Reviewing the output tidygraph‚Äôs graph object**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_graph\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 54 nodes and 1372 edges\n#\n# A directed multigraph with 1 component\n#\n# Node Data: 54 √ó 4 (active)\n      id label               Department     Title                               \n   <dbl> <chr>               <chr>          <chr>                               \n 1     1 Mat.Bramar          Administration Assistant to CEO                    \n 2     2 Anda.Ribera         Administration Assistant to CFO                    \n 3     3 Rachel.Pantanal     Administration Assistant to CIO                    \n 4     4 Linda.Lagos         Administration Assistant to COO                    \n 5     5 Ruscella.Mies.Haber Administration Assistant to Engineering Group Mana‚Ä¶\n 6     6 Carla.Forluniau     Administration Assistant to IT Group Manager       \n 7     7 Cornelia.Lais       Administration Assistant to Security Group Manager \n 8    44 Kanon.Herrero       Security       Badging Office                      \n 9    45 Varja.Lagos         Security       Badging Office                      \n10    46 Stenig.Fusil        Security       Building Control                    \n# ‚Ñπ 44 more rows\n#\n# Edge Data: 1,372 √ó 4\n   from    to Weekday Weight\n  <int> <int> <ord>    <int>\n1     1     2 Sunday       5\n2     1     2 Monday       2\n3     1     2 Tuesday      3\n# ‚Ñπ 1,369 more rows\n```\n\n\n:::\n:::\n\n\n\n::::: goals\n::: goals-header\nReview\n:::\n\n::: goals-container\n-   The output above reveals that *GAStech_graph* is a tbl_graph object with 54 nodes and 4541 edges.\n-   The command also prints the first six rows of ‚ÄúNode Data‚Äù and the first three of ‚ÄúEdge Data‚Äù.\n-   It states that the Node Data is **active**. The notion of an active tibble within a tbl_graph object makes it possible to manipulate the data in one tibble at a time.\n:::\n:::::\n\n### 4.5 **Changing the active object**\n\nThe nodes tibble data frame is activated by default, but we can change which tibble data frame is active with the *activate()* function. Thus, if we wanted to rearrange the rows in the edges tibble to list those with the highest ‚Äúweight‚Äù first, we could use *activate()* and then *arrange()*. Visit the reference guide of activate() to find out more about the function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_graph %>%\n  activate(edges) %>%\n  arrange(desc(Weight))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 54 nodes and 1372 edges\n#\n# A directed multigraph with 1 component\n#\n# Edge Data: 1,372 √ó 4 (active)\n    from    to Weekday   Weight\n   <int> <int> <ord>      <int>\n 1    40    41 Saturday      13\n 2    41    43 Monday        11\n 3    35    31 Tuesday       10\n 4    40    41 Monday        10\n 5    40    43 Monday        10\n 6    36    32 Sunday         9\n 7    40    43 Saturday       9\n 8    41    40 Monday         9\n 9    19    15 Wednesday      8\n10    35    38 Tuesday        8\n# ‚Ñπ 1,362 more rows\n#\n# Node Data: 54 √ó 4\n     id label           Department     Title           \n  <dbl> <chr>           <chr>          <chr>           \n1     1 Mat.Bramar      Administration Assistant to CEO\n2     2 Anda.Ribera     Administration Assistant to CFO\n3     3 Rachel.Pantanal Administration Assistant to CIO\n# ‚Ñπ 51 more rows\n```\n\n\n:::\n:::\n\n\n\n## 5 Plotting static network graphs with **ggraph** package\n\n[**ggraph**](https://ggraph.data-imaginist.com/) is an extension of **ggplot2**, making it easier to carry over basic ggplot skills to the design of network graphs.\n\nAs in all network graph, there are three main aspects to a **ggraph**‚Äôs network graph, they are: - [nodes](https://cran.r-project.org/web/packages/ggraph/vignettes/Nodes.html), - [edges](https://cran.r-project.org/web/packages/ggraph/vignettes/Edges.html) and - [layouts](https://cran.r-project.org/web/packages/ggraph/vignettes/Layouts.html).\n\nAbove have comprehensive discussion of each of this aspect of graph.\n\n### 5.1 **Plotting a basic network graph**\n\nThe code chunk below uses [*ggraph()*](https://ggraph.data-imaginist.com/reference/ggraph.html), [*geom-edge_link()*](https://ggraph.data-imaginist.com/reference/geom_edge_link.html) and [*geom_node_point()*](https://ggraph.data-imaginist.com/reference/geom_node_point.html) to plot a network graph by using *GAStech_graph*.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nggraph(GAStech_graph) +\n  geom_edge_link() +\n  geom_node_point()\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_09_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n::::: goals\n::: goals-header\nLaern from code\n:::\n\n::: goals-container\n-   The basic plotting function is `ggraph()`, which takes the data to be used for the graph and the type of layout desired. Both of the arguments for `ggraph()` are built around *igraph*. Therefore, `ggraph()` can use either an *igraph* object or a *tbl_graph* object.\n:::\n:::::\n\n### 5.2 **Changing the default network graph theme**\n\nIn this section, you will use [*theme_graph()*](https://ggraph.data-imaginist.com/reference/theme_graph.html) to remove the x and y axes.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ng <- ggraph(GAStech_graph) + \n  geom_edge_link(aes()) +\n  geom_node_point(aes())\n\ng + theme_graph(background = \"#f1f4f5\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_09_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n::::: goals\n::: goals-header\nLearn from the code\n:::\n\n::: goals-container\n:::\n\n-   **ggraph** introduces a special ggplot theme that provides better defaults for network graphs than the normal ggplot defaults. `theme_graph()`, besides removing axes, grids, and border, changes the font to Arial Narrow (this can be overridden).\n-   The ggraph theme can be set for a series of plots with the `set_graph_style()` command run before the graphs are plotted or by using `theme_graph()` in the individual plots.\n:::::\n\n### 5.3 **Changing the coloring of the plot**\n\n`theme_graph()` makes it easy to change the coloring of the plot.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ng <- ggraph(GAStech_graph) + \n  geom_edge_link(aes(colour = 'grey50', size = 0.4)) +\n  geom_node_point(aes(colour = 'grey40'))\n\ng + theme_graph(background = 'grey10',\n                text_colour = 'white')\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_09_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n### 5.4 **Working with ggraph‚Äôs layouts**\n\n**ggraph** support many layout for standard used, they are: star, circle, nicely (default), dh, gem, graphopt, grid, mds, spahere, randomly, fr, kk, drl and lgl. Figures below and on the right show layouts supported by `ggraph()`.\n\n![](images/image4.jpg){fig-align=\"centre\" width=\"600\"}\n\n![](images/image5.jpg){fig-align=\"centre\" width=\"600\"}\n\n### 5.5 **Fruchterman and Reingold layout**\n\nBelow plot the network graph using **Fruchterman and Reingold layout**.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ng <- ggraph(GAStech_graph, \n            layout = \"fr\") +\n  geom_edge_link(aes()) +\n  geom_node_point(aes())\n\ng + theme_graph(background = \"#f1f4f5\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_09_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n::::: goals\n::: goals-header\nLaern from code\n:::\n\n::: goals-container\n-   *layout* argument is used to define the layout to be used.\n:::\n:::::\n\n\n### 5.6 **Modifying network nodes**\n\n### 5.7 **Modifying edges**\n\n## 6 Creating face graphs\n\n## 7 Network metrics analysis\n\n## 8 Building interactive network graph with visNetwork\n\n## 9 Reference\n\n# STUDY\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidygraph)\ncreate_ring(10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 10 nodes and 10 edges\n#\n# An undirected simple graph with 1 component\n#\n# Node Data: 10 √ó 0 (active)\n#\n# Edge Data: 10 √ó 2\n   from    to\n  <int> <int>\n1     1     2\n2     2     3\n3     3     4\n# ‚Ñπ 7 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\niris_clust <- hclust(dist(iris[1:4]))\niris_tree <- as_tbl_graph(iris_clust)\niris_tree\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 299 nodes and 298 edges\n#\n# A rooted tree\n#\n# Node Data: 299 √ó 4 (active)\n   height leaf  label members\n    <dbl> <lgl> <chr>   <int>\n 1  0     TRUE  \"108\"       1\n 2  0     TRUE  \"131\"       1\n 3  0.265 FALSE \"\"          2\n 4  0     TRUE  \"103\"       1\n 5  0     TRUE  \"126\"       1\n 6  0     TRUE  \"130\"       1\n 7  0.346 FALSE \"\"          2\n 8  0.520 FALSE \"\"          3\n 9  0.557 FALSE \"\"          5\n10  0     TRUE  \"119\"       1\n# ‚Ñπ 289 more rows\n#\n# Edge Data: 298 √ó 2\n   from    to\n  <int> <int>\n1     3     1\n2     3     2\n3     7     5\n# ‚Ñπ 295 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\niris_tree %>% activate(edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 299 nodes and 298 edges\n#\n# A rooted tree\n#\n# Edge Data: 298 √ó 2 (active)\n    from    to\n   <int> <int>\n 1     3     1\n 2     3     2\n 3     7     5\n 4     7     6\n 5     8     4\n 6     8     7\n 7     9     3\n 8     9     8\n 9    13    11\n10    13    12\n# ‚Ñπ 288 more rows\n#\n# Node Data: 299 √ó 4\n  height leaf  label members\n   <dbl> <lgl> <chr>   <int>\n1  0     TRUE  \"108\"       1\n2  0     TRUE  \"131\"       1\n3  0.265 FALSE \"\"          2\n# ‚Ñπ 296 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nas_tibble(iris_tree)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 299 √ó 4\n   height leaf  label members\n    <dbl> <lgl> <chr>   <int>\n 1  0     TRUE  \"108\"       1\n 2  0     TRUE  \"131\"       1\n 3  0.265 FALSE \"\"          2\n 4  0     TRUE  \"103\"       1\n 5  0     TRUE  \"126\"       1\n 6  0     TRUE  \"130\"       1\n 7  0.346 FALSE \"\"          2\n 8  0.520 FALSE \"\"          3\n 9  0.557 FALSE \"\"          5\n10  0     TRUE  \"119\"       1\n# ‚Ñπ 289 more rows\n```\n\n\n:::\n:::\n\n\n\n## The dplyr verbs\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\niris_tree <- iris_tree %>% \n    activate(nodes) %>% \n    mutate(Species = ifelse(leaf, as.character(iris$Species)[label], NA)) %>% \n    activate(edges) %>% \n    mutate(to_setose = .N()$Species[to] == 'setosa')\niris_tree\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 299 nodes and 298 edges\n#\n# A rooted tree\n#\n# Edge Data: 298 √ó 3 (active)\n    from    to to_setose\n   <int> <int> <lgl>    \n 1     3     1 NA       \n 2     3     2 NA       \n 3     7     5 NA       \n 4     7     6 NA       \n 5     8     4 NA       \n 6     8     7 NA       \n 7     9     3 NA       \n 8     9     8 NA       \n 9    13    11 NA       \n10    13    12 NA       \n# ‚Ñπ 288 more rows\n#\n# Node Data: 299 √ó 5\n  height leaf  label members Species\n   <dbl> <lgl> <chr>   <int> <chr>  \n1  0     TRUE  \"108\"       1 <NA>   \n2  0     TRUE  \"131\"       1 <NA>   \n3  0.265 FALSE \"\"          2 <NA>   \n# ‚Ñπ 296 more rows\n```\n\n\n:::\n:::\n\n\n\n`.N()` function is used to gain access to the node data while manipulating the edge data. Similarly `.E()` will give you the edge data and `.G()` will give you the `tbl_graph` object itself.\n\nWhile one might expect all of `dplyr`s verbs to be supported in that manner, there is a clear limitation in the relational data structure that requires rows to maintain their identity. Thus, `summarise()` and `do()` are not allowed as there is no clear interpretation of how alterations on the node and edge data with these verbs should be interpreted. If these operations are required I suggest applying them to a tibble representation and then joining the result back in.\n\nSpeaking of joining, all joins from `dplyr` are supported. Nodes and edges are added and removed as required by the join. New edge data to be joined in must have a `to` and `from` column referencing valid nodes in the existing graph.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\niris_sum <- iris %>% \n    group_by(Species) %>% \n    summarise_all(mean) %>% \n    ungroup()\niris_tree <- iris_tree %>% \n    activate(nodes) %>% \n    left_join(iris_sum)\niris_tree\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tbl_graph: 299 nodes and 298 edges\n#\n# A rooted tree\n#\n# Node Data: 299 √ó 9 (active)\n   height leaf  label members Species Sepal.Length Sepal.Width Petal.Length\n    <dbl> <lgl> <chr>   <int> <chr>          <dbl>       <dbl>        <dbl>\n 1  0     TRUE  \"108\"       1 <NA>              NA          NA           NA\n 2  0     TRUE  \"131\"       1 <NA>              NA          NA           NA\n 3  0.265 FALSE \"\"          2 <NA>              NA          NA           NA\n 4  0     TRUE  \"103\"       1 <NA>              NA          NA           NA\n 5  0     TRUE  \"126\"       1 <NA>              NA          NA           NA\n 6  0     TRUE  \"130\"       1 <NA>              NA          NA           NA\n 7  0.346 FALSE \"\"          2 <NA>              NA          NA           NA\n 8  0.520 FALSE \"\"          3 <NA>              NA          NA           NA\n 9  0.557 FALSE \"\"          5 <NA>              NA          NA           NA\n10  0     TRUE  \"119\"       1 <NA>              NA          NA           NA\n# ‚Ñπ 289 more rows\n# ‚Ñπ 1 more variable: Petal.Width <dbl>\n#\n# Edge Data: 298 √ó 3\n   from    to to_setose\n  <int> <int> <lgl>    \n1     3     1 NA       \n2     3     2 NA       \n3     7     5 NA       \n# ‚Ñπ 295 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggraph)\ngr1 <- create_notable('bull') %>% \n    mutate(name = letters[1:5])\ngr2 <- create_ring(5) %>% \n    mutate(name = letters[4:8])\n\n# Plot\ngr1 %>% bind_graphs(gr2) %>% \n    ggraph(layout = 'kk') + \n    geom_edge_link() + \n    geom_node_point(size = 8, colour = 'steelblue') +\n    geom_node_text(aes(label = name), colour = 'white', vjust = 0.4) + \n    ggtitle('Binding graphs') + \n    theme_graph()\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_09_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngr1 %>% graph_join(gr2) %>% \n    ggraph(layout = 'kk') + \n    geom_edge_link() + \n    geom_node_point(size = 8, colour = 'steelblue') +\n    geom_node_text(aes(label = name), colour = 'white', vjust = 0.4) + \n    ggtitle('Joining graphs') + \n    theme_graph()\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex_09_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Hands-on_Ex_09_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}